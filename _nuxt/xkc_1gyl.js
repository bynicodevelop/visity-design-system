import{_ as R}from"./D1OhZ0R3.js";import{_ as oe}from"./DMsjQPwu.js";import{_ as ne,b as J,a as z,d as te,c as I,u as ie}from"./Cqazu3V4.js";import{j as C,D as H,E as G,B as h,o as f,b as l,v as b,X as le,a2 as ue,n as me,r as w,l as A,u as o,I as E,H as B,x as D,C as de,F as pe,w as K,a3 as ce,y as fe,c as T,a as k,L as O,M as _e,P as ve,K as ge}from"./Dr2B6r8K.js";import{_ as L}from"./DlAUqK2U.js";import{_ as be}from"./CyPIaHqa.js";import{_ as ye}from"./BFHQn83K.js";import{s as M}from"./ug01hfsv.js";import{g as qe,u as he,G as xe,H as Fe,I as we,b as Ve,e as $e,h as Ie,q as ke}from"./DUbpLHlo.js";import{u as Ce}from"./BrwKZLhf.js";import{u as Pe}from"./Bp1FuEAv.js";import{u as Se}from"./Ds4SP-TA.js";const X=C({__name:"PrefixedInput",props:H({id:{},name:{},prefix:{},required:{type:Boolean},label:{},placeholder:{},errors:{},disabled:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=G(t,"modelValue");return(r,a)=>{const u=ne;return f(),h("div",null,[l(u,{id:r.id,modelValue:e.value,"onUpdate:modelValue":[a[0]||(a[0]=n=>e.value=n),a[1]||(a[1]=n=>e.value=n)],label:r.label||"Nom d'utilisateur",placeholder:r.placeholder||"JohnDoe",prefix:r.prefix,name:r.name,required:r.required||!1,errors:r.errors,disabled:r.disabled||!1,type:"text"},null,8,["id","modelValue","label","placeholder","prefix","name","required","errors","disabled"])])}}});X.__docgenInfo={exportName:"default",displayName:"PrefixedInput",description:"",tags:{},props:[{name:"id",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"prefix",required:!0,type:{name:"string"}},{name:"required",required:!1,type:{name:"boolean"}},{name:"label",required:!1,type:{name:"string"}},{name:"placeholder",required:!1,type:{name:"string"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"disabled",required:!1,type:{name:"boolean"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/PrefixedInput.vue"]};const Ue={class:"grid"},Ne={class:"mt-2"},Ae=["id","name","placeholder","disabled"],Q=C({__name:"Textarea",props:H({label:{},name:{},id:{},placeholder:{},errors:{},required:{type:Boolean},disabled:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=G(t,"modelValue");return(r,a)=>{const u=J,n=z;return f(),h("div",Ue,[l(u,{label:r.label,name:r.name,required:r.required,errors:r.errors},null,8,["label","name","required","errors"]),b("div",Ne,[le(b("textarea",me({id:r.id,"onUpdate:modelValue":a[0]||(a[0]=_=>e.value=_),name:r.name,placeholder:r.placeholder,disabled:r.disabled||!1},r.required!==void 0&&r.required!==!1?{required:!0,"aria-required":"true"}:{},{rows:"3","onUpdate:modelValue":a[1]||(a[1]=_=>e.value=_)}),null,16,Ae),[[ue,e.value]])]),l(n,{errors:r.errors??[]},null,8,["errors"])])}}}),Ee=L(Q,[["__scopeId","data-v-668e451e"]]);Q.__docgenInfo={exportName:"default",displayName:"Textarea",description:"",tags:{},props:[{name:"label",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"id",required:!0,type:{name:"string"}},{name:"placeholder",required:!1,type:{name:"string"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"required",required:!1,type:{name:"boolean"}},{name:"disabled",required:!1,type:{name:"boolean"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/Textarea.vue"]};const Be={class:"mt-2 flex items-center gap-x-3"},Me=["accept"],W=C({__name:"ImageInput",props:{label:{},name:{},preview:{},required:{type:Boolean},errors:{},accept:{},onChange:{type:Function}},setup(t){const e=t,r=w(null),a=w(null),u=A(()=>{var m;return((m=e.accept)==null?void 0:m.join(","))??"image/*"}),n=A(()=>a.value??e.preview??null),_=m=>!e.accept||e.accept.length===0?!0:e.accept.some(s=>m.type.includes(s)),y=m=>{var q;const d=(q=m.target.files)==null?void 0:q[0];d&&_(d)?(a.value=URL.createObjectURL(d),e.onChange(d)):a.value=null},v=()=>{var m;(m=r.value)==null||m.click()};return(m,s)=>{const d=J,q=be,V=R,x=z;return f(),h("div",null,[l(d,{label:e.label,name:e.name,required:e.required,errors:e.errors},null,8,["label","name","required","errors"]),b("div",Be,[l(q,{src:o(n),alt:"Avatar Preview",size:"sm"},null,8,["src"]),l(V,{label:"Change",color:"secondary",size:"sm",onClick:E(v,["prevent"])}),b("input",{ref_key:"inputFile",ref:r,type:"file",class:"hidden",accept:o(u),onChange:y},null,40,Me)]),l(x,{errors:m.errors??[]},null,8,["errors"])])}}});W.__docgenInfo={exportName:"default",displayName:"ImageInput",description:"",tags:{},props:[{name:"label",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"preview",required:!1,type:{name:"string"}},{name:"required",required:!1,type:{name:"boolean"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"accept",required:!1,type:{name:"Array",elements:[{name:"ImageFileAccept"}]}},{name:"onChange",required:!0,type:{name:"TSFunctionType"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/ImageInput.vue"]};const Le={key:0},je={key:1},Y=C({__name:"Fieldset",props:{legend:{},description:{}},setup(t){return(e,r)=>(f(),h("fieldset",null,[e.legend?(f(),h("legend",Le,D(e.legend),1)):B("",!0),e.description?(f(),h("p",je,D(e.description),1)):B("",!0),b("section",{class:pe({"pt-8 mt-4":e.description||e.legend})},[de(e.$slots,"default",{},void 0,!0)],2)]))}}),De=L(Y,[["__scopeId","data-v-69f870c0"]]);Y.__docgenInfo={exportName:"default",displayName:"Fieldset",description:"",tags:{},props:[{name:"legend",required:!1,type:{name:"string"}},{name:"description",required:!1,type:{name:"string"}}],slots:[{name:"default"}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/Fieldset.vue"]};const Te=qe("useSearchUsernameStore",()=>{const t=w({exists:!1,owned:!1});return{usernameExist:t,searchExistingUsername:async r=>{const a=await $fetch("/api/profile/exist",{query:{username:`@${r}`}});t.value=a}}}),Oe=()=>{const{$storage:t}=he();return{uploadFile:async(r,a)=>{const u=xe(t,a),n=await Fe(u,r);return we(n.ref)}}},Re=(t,e)=>{const r=w(t.value);let a;return K(t,u=>{a&&clearTimeout(a),a=setTimeout(()=>{r.value=u},e)}),r},Je=async()=>{var g,i,F,S;const{params:t}=Ve(),e=$e(),r=ke(),a=Ie(),u=Te(),n=Ce(),_=Pe(),{uploadFile:y}=Oe(),v=w(null),m={uid:I().required("L'identifiant est requis."),username:I().required("Le nom d'utilisateur est requis."),bio:I().required("La bio est requise."),image:I(),socials:te(Object.fromEntries(Object.keys(M).map(c=>[c,I().optional()]))).optional()},{fields:s,fieldsAttrs:d,errors:q,meta:V}=ie({validationSchema:m}),x=Object.fromEntries(Object.keys(M).map(c=>[c,""]));s.socials.value=x,t.username&&(await Se("user-profile",()=>n.fetchProfile(t.username)),s.username.value=((g=n.profile)==null?void 0:g.username)??"",s.bio.value=((i=n.profile)==null?void 0:i.bio)??"",s.image.value=((F=n.profile)==null?void 0:F.image)??"",s.socials.value=((S=n.profile)==null?void 0:S.socials)??x);const U=async()=>{await a.fetchUser();const c=a.user;s.uid.value=c.id},$=async()=>{if(v.value){const c=await y(v.value,`images/${s.uid.value}/${s.username.value}/profile`);s.image.value=c}try{await n.addProfile({username:s.username.value,bio:s.bio.value,image:s.image.value,socials:JSON.parse(JSON.stringify(s.socials.value))}),_.addAlert("Enregistrement réussi","Votre profil a été enregistré avec succès.","success"),n.profile&&e.push(`/dashboard/profiles/${s.username.value}`)}catch(c){console.error(c.message)}},P=async()=>{await n.deleteProfile(s.username.value),e.push("/dashboard")},N=Re(s.username,500);return K(N,u.searchExistingUsername),{searchUsername:u,profileStore:n,domain:r.public.domain,fields:s,fieldsAttrs:d,errors:q,meta:V,file:v,fetchProfile:U,submitForm:$,deleteAccount:P}},Z=C({__name:"PublicProfile",async setup(t){let e,r;const{searchUsername:a,profileStore:u,meta:n,domain:_,fields:{username:y,bio:v,image:m,socials:s},errors:d,file:q,fetchProfile:V,submitForm:x,deleteAccount:U}=([e,r]=ce(()=>Je()),e=await e,r(),e),$=w(!1),P=A(()=>{const g=[];return a.usernameExist.exists&&g.push("Ce nom d'utilisateur est déjà utilisé."),d.value.username&&g.push(d.value.username),g});fe(async()=>await V());const N=g=>q.value=g;return(g,i)=>{const F=R,S=oe,c=X,ee=Ee,re=W,j=De,ae=ye;return f(),h("form",{action:"post",onSubmit:i[4]||(i[4]=E((...p)=>o(x)&&o(x)(...p),["prevent"]))},[l(S,{"is-open":o($)},{content:k(()=>i[5]||(i[5]=[b("div",{class:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left"},[b("h3",{id:"modal-title",class:"text-base font-semibold text-gray-900"}," Supprimer mon compte "),b("div",{class:"mt-2"},[b("p",{class:"text-sm text-gray-500"}," Êtes-vous sûr de vouloir continuer ? ")])],-1)])),actions:k(()=>[l(F,{type:"button",label:"Annuler",color:"secondary",onClick:i[0]||(i[0]=p=>$.value=!1)}),l(F,{type:"button",label:"Confirmer",color:"danger",onClick:o(U)},null,8,["onClick"])]),_:1},8,["is-open"]),l(j,{legend:"Informations publiques",description:"Ces informations seront visibles par tous les utilisateurs."},{default:k(()=>[l(c,{id:"username",modelValue:o(y),"onUpdate:modelValue":i[1]||(i[1]=p=>O(y)?y.value=p:null),prefix:`${o(_)}/@`,disabled:!!o(u).profile,errors:o(P).length>0?o(P):[],name:"username",label:"Nom d'utilisateur",placeholder:"JohnDoe",required:""},null,8,["modelValue","prefix","disabled","errors"]),l(ee,{id:"bio",modelValue:o(v),"onUpdate:modelValue":i[2]||(i[2]=p=>O(v)?v.value=p:null),name:"bio",label:"Bio",placeholder:"Je suis un développeur web passionné par les technologies modernes.",errors:o(d).bio?[o(d).bio]:[]},null,8,["modelValue","errors"]),l(re,{id:"avatar",preview:o(m),name:"avatar",label:"Avatar",required:"",errors:o(d).avatar?[o(d).avatar]:[],onChange:N},null,8,["preview","errors"])]),_:1}),l(j,{legend:"Réseaux sociaux",description:"Ajoutez vos réseaux sociaux pour que les autres utilisateurs puissent vous suivre."},{default:k(()=>[(f(!0),h(_e,null,ve(o(M),p=>(f(),T(c,{id:p.id,key:p.id,modelValue:o(s)[p.id],"onUpdate:modelValue":se=>o(s)[p.id]=se,prefix:p.domain,name:p.id,label:p.name,placeholder:"johndoe"},null,8,["id","modelValue","onUpdate:modelValue","prefix","name","label"]))),128))]),_:1}),l(F,{type:"submit",label:"Enregistrer","read-only":o(a).usernameExist.exists||!o(n).valid},null,8,["read-only"]),l(ae,{to:`/@${o(y)}`,target:"_blank"},{default:k(()=>i[6]||(i[6]=[ge(" Voir mon profil public ")])),_:1},8,["to"]),o(u).profile?(f(),T(F,{key:0,type:"button",label:"Supprimer mon compte",color:"danger",onClick:i[3]||(i[3]=E(p=>$.value=!0,["prevent"]))})):B("",!0)],32)}}}),sr=L(Z,[["__scopeId","data-v-b39cf796"]]);Z.__docgenInfo={exportName:"default",displayName:"PublicProfile",description:"",tags:{},sourceFiles:["/home/runner/work/visity.me/visity.me/components/app/form/PublicProfile.vue"]};export{sr as _};

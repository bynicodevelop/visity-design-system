import{_ as G}from"./ONAoSqDB.js";import{_ as ne}from"./ZDZy2wXW.js";import{_ as te,b as Q,a as Y,d as ie,c as C,u as le}from"./BiWUJPMl.js";import{d as S,q as K,s as W,k as q,o as f,b as l,a as v,Y as ue,a5 as me,m as de,r as w,e as B,u as s,A as L,z as T,t as O,l as pe,v as ce,H as j,a6 as fe,f as ve,c as z,w as I,I as J,R as _e,Q as ge,C as be}from"./6VV17LS1.js";import{_ as R}from"./DlAUqK2U.js";import{_ as ye}from"./ByZg6SHC.js";import{_ as qe}from"./Bksg9kKx.js";import{s as D}from"./ug01hfsv.js";import{e as he,u as xe,G as Fe,H as Ve,I as we,a as $e,c as ke,f as Ce,k as Ie}from"./XbrZPR0v.js";import{u as Se}from"./ByRaIkWe.js";import{u as Ue}from"./BHaF486D.js";import{u as Pe}from"./D0HAhHbh.js";import{u as Ae}from"./B57BD4FQ.js";const X=S({__name:"PrefixedInput",props:K({id:{},name:{},prefix:{},required:{type:Boolean},label:{},placeholder:{},errors:{},disabled:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const r=W(n,"modelValue");return(a,o)=>{const m=te;return f(),q("div",null,[l(m,{id:a.id,modelValue:r.value,"onUpdate:modelValue":[o[0]||(o[0]=p=>r.value=p),o[1]||(o[1]=p=>r.value=p)],label:a.label||"Nom d'utilisateur",placeholder:a.placeholder||"JohnDoe",prefix:a.prefix,name:a.name,required:a.required||!1,errors:a.errors,disabled:a.disabled||!1,type:"text"},null,8,["id","modelValue","label","placeholder","prefix","name","required","errors","disabled"])])}}});X.__docgenInfo={exportName:"default",displayName:"PrefixedInput",description:"",tags:{},props:[{name:"id",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"prefix",required:!0,type:{name:"string"}},{name:"required",required:!1,type:{name:"boolean"}},{name:"label",required:!1,type:{name:"string"}},{name:"placeholder",required:!1,type:{name:"string"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"disabled",required:!1,type:{name:"boolean"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/PrefixedInput.vue"]};const Ne={class:"grid"},Be={class:"mt-2"},Ee=["id","name","placeholder","disabled"],Z=S({__name:"Textarea",props:K({label:{},name:{},id:{},placeholder:{},errors:{},required:{type:Boolean},disabled:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const r=W(n,"modelValue");return(a,o)=>{const m=Q,p=Y;return f(),q("div",Ne,[l(m,{label:a.label,name:a.name,required:a.required,errors:a.errors},null,8,["label","name","required","errors"]),v("div",Be,[ue(v("textarea",de({id:a.id,"onUpdate:modelValue":o[0]||(o[0]=t=>r.value=t),name:a.name,placeholder:a.placeholder,disabled:a.disabled||!1},a.required!==void 0&&a.required!==!1?{required:!0,"aria-required":"true"}:{},{rows:"3","onUpdate:modelValue":o[1]||(o[1]=t=>r.value=t)}),null,16,Ee),[[me,r.value]])]),l(p,{errors:a.errors??[]},null,8,["errors"])])}}}),Me=R(Z,[["__scopeId","data-v-668e451e"]]);Z.__docgenInfo={exportName:"default",displayName:"Textarea",description:"",tags:{},props:[{name:"label",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"id",required:!0,type:{name:"string"}},{name:"placeholder",required:!1,type:{name:"string"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"required",required:!1,type:{name:"boolean"}},{name:"disabled",required:!1,type:{name:"boolean"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/Textarea.vue"]};const Le={class:"mt-2 flex items-center gap-x-3"},Te=["accept"],ee=S({__name:"ImageInput",props:{label:{},name:{},preview:{},required:{type:Boolean},errors:{},accept:{},onChange:{type:Function}},setup(n){const r=n,a=w(null),o=w(null),m=B(()=>{var i;return((i=r.accept)==null?void 0:i.join(","))??"image/*"}),p=B(()=>o.value??r.preview??null),t=i=>!r.accept||r.accept.length===0?!0:r.accept.some(g=>i.type.includes(g)),_=i=>{var b;const e=(b=i.target.files)==null?void 0:b[0];e&&t(e)?(o.value=URL.createObjectURL(e),r.onChange(e)):o.value=null},h=()=>{var i;(i=a.value)==null||i.click()};return(i,g)=>{const e=Q,b=ye,$=G,x=Y;return f(),q("div",null,[l(e,{label:r.label,name:r.name,required:r.required,errors:r.errors},null,8,["label","name","required","errors"]),v("div",Le,[l(b,{src:s(p),alt:"Avatar Preview",size:"sm"},null,8,["src"]),l($,{label:"Change",color:"secondary",size:"sm",onClick:L(h,["prevent"])}),v("input",{ref_key:"inputFile",ref:a,type:"file",class:"hidden",accept:s(m),onChange:_},null,40,Te)]),l(x,{errors:i.errors??[]},null,8,["errors"])])}}});ee.__docgenInfo={exportName:"default",displayName:"ImageInput",description:"",tags:{},props:[{name:"label",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"preview",required:!1,type:{name:"string"}},{name:"required",required:!1,type:{name:"boolean"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"accept",required:!1,type:{name:"Array",elements:[{name:"ImageFileAccept"}]}},{name:"onChange",required:!0,type:{name:"TSFunctionType"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/ImageInput.vue"]};const je={key:0},De={key:1},re=S({__name:"Fieldset",props:{legend:{},description:{}},setup(n){return(r,a)=>(f(),q("fieldset",null,[r.legend?(f(),q("legend",je,O(r.legend),1)):T("",!0),r.description?(f(),q("p",De,O(r.description),1)):T("",!0),v("section",{class:ce({"pt-8 mt-4":r.description||r.legend})},[pe(r.$slots,"default",{},void 0,!0)],2)]))}}),Re=R(re,[["__scopeId","data-v-69f870c0"]]);re.__docgenInfo={exportName:"default",displayName:"Fieldset",description:"",tags:{},props:[{name:"legend",required:!1,type:{name:"string"}},{name:"description",required:!1,type:{name:"string"}}],slots:[{name:"default"}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/Fieldset.vue"]};const Oe=he("useSearchUsernameStore",()=>{const n=w({exists:!1,owned:!1});return{usernameExist:n,searchExistingUsername:async a=>{const o=await $fetch("/api/profile/exist",{query:{username:`@${a}`}});n.value=o}}}),ze=()=>{const{$storage:n}=xe();return{uploadFile:async(a,o)=>{const m=Fe(n,o),p=await Ve(m,a);return we(p.ref)}}},H=(n,r)=>{const a=w(n.value);let o;return j(n,m=>{o&&clearTimeout(o),o=setTimeout(()=>{a.value=m},r)}),a},Je=async()=>{var P,k,A,N;const{params:n}=$e(),r=ke(),a=Ie(),o=Ce(),m=Oe(),p=Se(),t=Ue(),_=Pe(),{uploadFile:h}=ze(),i=w(null),g={uid:C().required("L'identifiant est requis."),username:C().required("Le nom d'utilisateur est requis."),bio:C().required("La bio est requise."),image:C(),socials:ie(Object.fromEntries(Object.keys(D).map(c=>[c,C().optional()]))).optional()},{fields:e,fieldsAttrs:b,errors:$,meta:x}=le({validationSchema:g}),E=B(()=>({username:e.username.value,bio:e.bio.value,image:e.image.value,socials:e.socials.value})),F=Object.fromEntries(Object.keys(D).map(c=>[c,""]));e.socials.value=F,n.username&&(await Ae("user-profile",()=>t.fetchProfile(n.username)),e.username.value=((P=t.profile)==null?void 0:P.username)??"",e.bio.value=((k=t.profile)==null?void 0:k.bio)??"",e.image.value=((A=t.profile)==null?void 0:A.image)??"",e.socials.value=((N=t.profile)==null?void 0:N.socials)??F,p.createComponentFromValues({bio:e.bio.value,image:e.image.value,username:e.username.value,socials:e.socials.value},"HeadingBio"));const U=async()=>{await o.fetchUser();const c=o.user;e.uid.value=c.id},M=async()=>{if(i.value){const c=await h(i.value,`images/${e.uid.value}/${e.username.value}/profile`);e.image.value=c}try{await t.addProfile({username:e.username.value,bio:e.bio.value,image:e.image.value,socials:JSON.parse(JSON.stringify(e.socials.value))}),_.addAlert("Enregistrement réussi","Votre profil a été enregistré avec succès.","success"),t.profile&&r.push(`/dashboard/profiles/${e.username.value}`)}catch(c){console.error(c.message)}},y=async()=>{await t.deleteProfile(e.username.value),r.push("/dashboard")},u=H(e.username,500);j(u,m.searchExistingUsername);const V=H(E,500);return j(V,c=>{p.createComponentFromValues(c,"HeadingBio")},{deep:!0}),{searchUsername:m,profileStore:t,domain:a.public.domain,fields:e,fieldsAttrs:b,errors:$,meta:x,file:i,fetchProfile:U,submitForm:M,deleteAccount:y}},ae=S({__name:"PublicProfile",async setup(n){let r,a;const{searchUsername:o,profileStore:m,meta:p,domain:t,fields:{username:_,bio:h,image:i,socials:g},errors:e,file:b,fetchProfile:$,submitForm:x,deleteAccount:E}=([r,a]=fe(()=>Je()),r=await r,a(),r),F=w(!1),U=B(()=>{const y=[];return o.usernameExist.exists&&y.push("Ce nom d'utilisateur est déjà utilisé."),e.value.username&&y.push(e.value.username),y});ve(async()=>await $());const M=y=>b.value=y;return(y,u)=>{const V=G,P=ne,k=X,A=Me,N=ee,c=Re,oe=qe;return f(),q("form",{action:"post",onSubmit:u[4]||(u[4]=L((...d)=>s(x)&&s(x)(...d),["prevent"]))},[l(P,{"is-open":s(F)},{content:I(()=>u[5]||(u[5]=[v("div",{class:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left"},[v("h3",{id:"modal-title",class:"text-base font-semibold text-gray-900"}," Supprimer mon compte "),v("div",{class:"mt-2"},[v("p",{class:"text-sm text-gray-500"}," Êtes-vous sûr de vouloir continuer ? ")])],-1)])),actions:I(()=>[l(V,{type:"button",label:"Annuler",color:"secondary",onClick:u[0]||(u[0]=d=>F.value=!1)}),l(V,{type:"button",label:"Confirmer",color:"danger",onClick:s(E)},null,8,["onClick"])]),_:1},8,["is-open"]),l(c,{legend:"Informations publiques",description:"Ces informations seront visibles par tous les utilisateurs."},{default:I(()=>[l(k,{id:"username",modelValue:s(_),"onUpdate:modelValue":u[1]||(u[1]=d=>J(_)?_.value=d:null),prefix:`${s(t)}/@`,disabled:!!s(m).profile,errors:s(U).length>0?s(U):[],name:"username",label:"Nom d'utilisateur",placeholder:"JohnDoe",required:""},null,8,["modelValue","prefix","disabled","errors"]),l(A,{id:"bio",modelValue:s(h),"onUpdate:modelValue":u[2]||(u[2]=d=>J(h)?h.value=d:null),name:"bio",label:"Bio",placeholder:"Je suis un développeur web passionné par les technologies modernes.",errors:s(e).bio?[s(e).bio]:[]},null,8,["modelValue","errors"]),l(N,{id:"avatar",preview:s(i),name:"avatar",label:"Avatar",required:"",errors:s(e).avatar?[s(e).avatar]:[],onChange:M},null,8,["preview","errors"])]),_:1}),l(c,{legend:"Réseaux sociaux",description:"Ajoutez vos réseaux sociaux pour que les autres utilisateurs puissent vous suivre."},{default:I(()=>[(f(!0),q(_e,null,ge(s(D),d=>(f(),z(k,{id:d.id,key:d.id,modelValue:s(g)[d.id],"onUpdate:modelValue":se=>s(g)[d.id]=se,prefix:d.domain,name:d.id,label:d.name,placeholder:"johndoe"},null,8,["id","modelValue","onUpdate:modelValue","prefix","name","label"]))),128))]),_:1}),l(V,{type:"submit",label:"Enregistrer","read-only":s(o).usernameExist.exists||!s(p).valid},null,8,["read-only"]),l(oe,{to:`/@${s(_)}`,target:"_blank"},{default:I(()=>u[6]||(u[6]=[be(" Voir mon profil public ")])),_:1},8,["to"]),s(m).profile?(f(),z(V,{key:0,type:"button",label:"Supprimer mon compte",color:"danger",onClick:u[3]||(u[3]=L(d=>F.value=!0,["prevent"]))})):T("",!0)],32)}}}),nr=R(ae,[["__scopeId","data-v-6e765ebd"]]);ae.__docgenInfo={exportName:"default",displayName:"PublicProfile",description:"",tags:{},sourceFiles:["/home/runner/work/visity.me/visity.me/components/app/form/PublicProfile.vue"]};export{nr as _};

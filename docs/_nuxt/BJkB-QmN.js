import{_ as W}from"./CpTvJxVd.js";import{e as k,j as Y,H as ue,c as D,o as v,Y as me,d as l,W as T,a as q,q as g,A as B,b as p,C as E,s as R,v as Q,x as X,_ as de,a6 as pe,m as ce,r as V,g as M,u as o,t as H,y as fe,w as z,a7 as ve,B as G,N as _e,L as ge,z as ye}from"./ynGhil90.js";import{_ as L}from"./DlAUqK2U.js";import{_ as be,b as Z,a as ee,d as he,c as S,u as qe}from"./CWmicVst.js";import{_ as xe}from"./BJpTlgDl.js";import{_ as we}from"./DOU7pFYv.js";import{s as J}from"./ug01hfsv.js";import{e as Fe,u as $e,G as Ve,H as ke,I as Ce,a as Ie,c as Se,f as Ne,k as Ue}from"./FdjDsa7y.js";import{u as Pe}from"./CmWCU4_Z.js";import{u as Ae}from"./B0EPGd8k.js";import{u as Be}from"./BNpst0ts.js";import{u as Ee}from"./DrHqhH6S.js";const Me={key:0,class:"relative z-10","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Le={class:"fixed inset-0 z-10 w-screen overflow-y-auto"},je={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Oe={class:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4"},Te={class:"sm:flex sm:items-start"},De={class:"flex justify-end space-x-2 bg-gray-50 px-4 py-3 sm:px-6"},re=k({__name:"Modal",props:{isOpen:{type:Boolean}},emits:["close"],setup(n,{emit:e}){const a=n,s=e,u=i=>{i.key==="Escape"&&a.isOpen&&s("close")};return Y(()=>{document.addEventListener("keydown",u)}),ue(()=>{document.removeEventListener("keydown",u)}),(i,t)=>(v(),D(me,{to:"body"},[l(T,{appear:"",name:"modal-fade"},{default:q(()=>[i.isOpen?(v(),g("div",Me,[l(T,{name:"modal-overlay",appear:""},{default:q(()=>[p("div",{class:"fixed inset-0 bg-gray-500/75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=_=>s("close"))})]),_:1}),p("div",Le,[p("div",je,[l(T,{name:"modal-content",appear:""},{default:q(()=>[p("div",{class:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",onClick:t[1]||(t[1]=E(()=>{},["stop"]))},[p("div",Oe,[p("div",Te,[R(i.$slots,"content",{},void 0,!0)])]),p("div",De,[R(i.$slots,"actions",{},void 0,!0)])])]),_:3})])])])):B("",!0)]),_:3})]))}}),Re=L(re,[["__scopeId","data-v-a0ba30e3"]]);re.__docgenInfo={exportName:"default",displayName:"Modal",description:"",tags:{},props:[{name:"isOpen",required:!0,type:{name:"boolean"}}],events:[{name:"close"}],slots:[{name:"content"},{name:"actions"}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/ui/Modal.vue"]};const ae=k({__name:"PrefixedInput",props:Q({id:{},name:{},prefix:{},required:{type:Boolean},label:{},placeholder:{},errors:{},disabled:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=X(n,"modelValue");return(a,s)=>{const u=be;return v(),g("div",null,[l(u,{id:a.id,modelValue:e.value,"onUpdate:modelValue":[s[0]||(s[0]=i=>e.value=i),s[1]||(s[1]=i=>e.value=i)],label:a.label||"Nom d'utilisateur",placeholder:a.placeholder||"JohnDoe",prefix:a.prefix,name:a.name,required:a.required||!1,errors:a.errors,disabled:a.disabled||!1,type:"text"},null,8,["id","modelValue","label","placeholder","prefix","name","required","errors","disabled"])])}}});ae.__docgenInfo={exportName:"default",displayName:"PrefixedInput",description:"",tags:{},props:[{name:"id",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"prefix",required:!0,type:{name:"string"}},{name:"required",required:!1,type:{name:"boolean"}},{name:"label",required:!1,type:{name:"string"}},{name:"placeholder",required:!1,type:{name:"string"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"disabled",required:!1,type:{name:"boolean"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/PrefixedInput.vue"]};const ze={class:"grid"},Je={class:"mt-2"},He=["id","name","placeholder","disabled"],se=k({__name:"Textarea",props:Q({label:{},name:{},id:{},placeholder:{},errors:{},required:{type:Boolean},disabled:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=X(n,"modelValue");return(a,s)=>{const u=Z,i=ee;return v(),g("div",ze,[l(u,{label:a.label,name:a.name,required:a.required,errors:a.errors},null,8,["label","name","required","errors"]),p("div",Je,[de(p("textarea",ce({id:a.id,"onUpdate:modelValue":s[0]||(s[0]=t=>e.value=t),name:a.name,placeholder:a.placeholder,disabled:a.disabled||!1},a.required!==void 0&&a.required!==!1?{required:!0,"aria-required":"true"}:{},{rows:"3","onUpdate:modelValue":s[1]||(s[1]=t=>e.value=t)}),null,16,He),[[pe,e.value]])]),l(i,{errors:a.errors??[]},null,8,["errors"])])}}}),Ge=L(se,[["__scopeId","data-v-668e451e"]]);se.__docgenInfo={exportName:"default",displayName:"Textarea",description:"",tags:{},props:[{name:"label",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"id",required:!0,type:{name:"string"}},{name:"placeholder",required:!1,type:{name:"string"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"required",required:!1,type:{name:"boolean"}},{name:"disabled",required:!1,type:{name:"boolean"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/Textarea.vue"]};const Ke={class:"mt-2 flex items-center gap-x-3"},We=["accept"],oe=k({__name:"ImageInput",props:{label:{},name:{},preview:{},required:{type:Boolean},errors:{},accept:{},onChange:{type:Function}},setup(n){const e=n,a=V(null),s=V(null),u=M(()=>{var m;return((m=e.accept)==null?void 0:m.join(","))??"image/*"}),i=M(()=>s.value??e.preview??null),t=m=>!e.accept||e.accept.length===0?!0:e.accept.some(y=>m.type.includes(y)),_=m=>{var b;const r=(b=m.target.files)==null?void 0:b[0];r&&t(r)?(s.value=URL.createObjectURL(r),e.onChange(r)):s.value=null},x=()=>{var m;(m=a.value)==null||m.click()};return(m,y)=>{const r=Z,b=xe,C=W,w=ee;return v(),g("div",null,[l(r,{label:e.label,name:e.name,required:e.required,errors:e.errors},null,8,["label","name","required","errors"]),p("div",Ke,[l(b,{src:o(i),alt:"Avatar Preview",size:"sm"},null,8,["src"]),l(C,{label:"Change",color:"secondary",size:"sm",onClick:E(x,["prevent"])}),p("input",{ref_key:"inputFile",ref:a,type:"file",class:"hidden",accept:o(u),onChange:_},null,40,We)]),l(w,{errors:m.errors??[]},null,8,["errors"])])}}});oe.__docgenInfo={exportName:"default",displayName:"ImageInput",description:"",tags:{},props:[{name:"label",required:!0,type:{name:"string"}},{name:"name",required:!0,type:{name:"string"}},{name:"preview",required:!1,type:{name:"string"}},{name:"required",required:!1,type:{name:"boolean"}},{name:"errors",required:!1,type:{name:"Array",elements:[{name:"string"}]}},{name:"accept",required:!1,type:{name:"Array",elements:[{name:"ImageFileAccept"}]}},{name:"onChange",required:!0,type:{name:"TSFunctionType"}}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/ImageInput.vue"]};const Ye={key:0},Qe={key:1},te=k({__name:"Fieldset",props:{legend:{},description:{}},setup(n){return(e,a)=>(v(),g("fieldset",null,[e.legend?(v(),g("legend",Ye,H(e.legend),1)):B("",!0),e.description?(v(),g("p",Qe,H(e.description),1)):B("",!0),p("section",{class:fe({"pt-8 mt-4":e.description||e.legend})},[R(e.$slots,"default",{},void 0,!0)],2)]))}}),Xe=L(te,[["__scopeId","data-v-69f870c0"]]);te.__docgenInfo={exportName:"default",displayName:"Fieldset",description:"",tags:{},props:[{name:"legend",required:!1,type:{name:"string"}},{name:"description",required:!1,type:{name:"string"}}],slots:[{name:"default"}],sourceFiles:["/home/runner/work/visity.me/visity.me/components/form/Fieldset.vue"]};const Ze=Fe("useSearchUsernameStore",()=>{const n=V({exists:!1,owned:!1});return{usernameExist:n,searchExistingUsername:async a=>{const s=await $fetch("/api/profile/exist",{query:{username:`@${a}`}});n.value=s}}}),er=()=>{const{$storage:n}=$e();return{uploadFile:async(a,s)=>{const u=Ve(n,s),i=await ke(u,a);return Ce(i.ref)}}},K=(n,e)=>{const a=V(n.value);let s;return z(n,u=>{s&&clearTimeout(s),s=setTimeout(()=>{a.value=u},e)}),a},rr=async()=>{var U,I,P,A;const{params:n}=Ie(),e=Se(),a=Ue(),s=Ne(),u=Ze(),i=Pe(),t=Ae(),_=Be(),{uploadFile:x}=er(),m=V(null),y={uid:S().required("L'identifiant est requis."),username:S().required("Le nom d'utilisateur est requis."),bio:S().required("La bio est requise."),image:S(),socials:he(Object.fromEntries(Object.keys(J).map(f=>[f,S().optional()]))).optional()},{fields:r,fieldsAttrs:b,errors:C,meta:w}=qe({validationSchema:y}),j=M(()=>({username:r.username.value,bio:r.bio.value,image:r.image.value,socials:r.socials.value})),F=Object.fromEntries(Object.keys(J).map(f=>[f,""]));r.socials.value=F,n.username&&(await Ee("user-profile",()=>t.fetchProfile(n.username)),r.username.value=((U=t.profile)==null?void 0:U.username)??"",r.bio.value=((I=t.profile)==null?void 0:I.bio)??"",r.image.value=((P=t.profile)==null?void 0:P.image)??"",r.socials.value=((A=t.profile)==null?void 0:A.socials)??F,i.createComponentFromValues({bio:r.bio.value,image:r.image.value,username:r.username.value,socials:r.socials.value},"HeadingBio"));const N=async()=>{await s.fetchUser();const f=s.user;r.uid.value=f.id},O=async()=>{if(m.value){const f=await x(m.value,`images/${r.uid.value}/${r.username.value}/profile`);r.image.value=f}try{await t.addProfile({username:r.username.value,bio:r.bio.value,image:r.image.value,socials:JSON.parse(JSON.stringify(r.socials.value))}),_.addAlert("Enregistrement réussi","Votre profil a été enregistré avec succès.","success"),t.profile&&e.push(`/dashboard/profiles/${r.username.value}`)}catch(f){console.error(f.message)}},h=async()=>{await t.deleteProfile(r.username.value),e.push("/dashboard")},d=K(r.username,500);z(d,u.searchExistingUsername);const $=K(j,500);return z($,f=>{i.createComponentFromValues(f,"HeadingBio")},{deep:!0}),{searchUsername:u,profileStore:t,domain:a.public.domain,fields:r,fieldsAttrs:b,errors:C,meta:w,file:m,fetchProfile:N,submitForm:O,deleteAccount:h}},ne=k({__name:"PublicProfile",async setup(n){let e,a;const{searchUsername:s,profileStore:u,meta:i,domain:t,fields:{username:_,bio:x,image:m,socials:y},errors:r,file:b,fetchProfile:C,submitForm:w,deleteAccount:j}=([e,a]=ve(()=>rr()),e=await e,a(),e),F=V(!1),N=M(()=>{const h=[];return s.usernameExist.exists&&h.push("Ce nom d'utilisateur est déjà utilisé."),r.value.username&&h.push(r.value.username),h});Y(async()=>await C());const O=h=>b.value=h;return(h,d)=>{const $=W,U=Re,I=ae,P=Ge,A=oe,f=Xe,ie=we;return v(),g("form",{action:"post",onSubmit:d[4]||(d[4]=E((...c)=>o(w)&&o(w)(...c),["prevent"]))},[l(U,{"is-open":o(F)},{content:q(()=>d[5]||(d[5]=[p("div",{class:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left"},[p("h3",{id:"modal-title",class:"text-base font-semibold text-gray-900"}," Supprimer mon compte "),p("div",{class:"mt-2"},[p("p",{class:"text-sm text-gray-500"}," Êtes-vous sûr de vouloir continuer ? ")])],-1)])),actions:q(()=>[l($,{type:"button",label:"Annuler",color:"secondary",onClick:d[0]||(d[0]=c=>F.value=!1)}),l($,{type:"button",label:"Confirmer",color:"danger",onClick:o(j)},null,8,["onClick"])]),_:1},8,["is-open"]),l(f,{legend:"Informations publiques",description:"Ces informations seront visibles par tous les utilisateurs."},{default:q(()=>[l(I,{id:"username",modelValue:o(_),"onUpdate:modelValue":d[1]||(d[1]=c=>G(_)?_.value=c:null),prefix:`${o(t)}/@`,disabled:!!o(u).profile,errors:o(N).length>0?o(N):[],name:"username",label:"Nom d'utilisateur",placeholder:"JohnDoe",required:""},null,8,["modelValue","prefix","disabled","errors"]),l(P,{id:"bio",modelValue:o(x),"onUpdate:modelValue":d[2]||(d[2]=c=>G(x)?x.value=c:null),name:"bio",label:"Bio",placeholder:"Je suis un développeur web passionné par les technologies modernes.",errors:o(r).bio?[o(r).bio]:[]},null,8,["modelValue","errors"]),l(A,{id:"avatar",preview:o(m),name:"avatar",label:"Avatar",required:"",errors:o(r).avatar?[o(r).avatar]:[],onChange:O},null,8,["preview","errors"])]),_:1}),l(f,{legend:"Réseaux sociaux",description:"Ajoutez vos réseaux sociaux pour que les autres utilisateurs puissent vous suivre."},{default:q(()=>[(v(!0),g(_e,null,ge(o(J),c=>(v(),D(I,{id:c.id,key:c.id,modelValue:o(y)[c.id],"onUpdate:modelValue":le=>o(y)[c.id]=le,prefix:c.domain,name:c.id,label:c.name,placeholder:"johndoe"},null,8,["id","modelValue","onUpdate:modelValue","prefix","name","label"]))),128))]),_:1}),l($,{type:"submit",label:"Enregistrer","read-only":o(s).usernameExist.exists||!o(i).valid},null,8,["read-only"]),l(ie,{to:`/@${o(_)}`,target:"_blank"},{default:q(()=>d[6]||(d[6]=[ye(" Voir mon profil public ")])),_:1},8,["to"]),o(u).profile?(v(),D($,{key:0,type:"button",label:"Supprimer mon compte",color:"danger",onClick:d[3]||(d[3]=E(c=>F.value=!0,["prevent"]))})):B("",!0)],32)}}}),fr=L(ne,[["__scopeId","data-v-6e765ebd"]]);ne.__docgenInfo={exportName:"default",displayName:"PublicProfile",description:"",tags:{},sourceFiles:["/home/runner/work/visity.me/visity.me/components/app/form/PublicProfile.vue"]};export{fr as _};
